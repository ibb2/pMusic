<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:pMusic.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:views="clr-namespace:pMusic.Views"
        xmlns:local="clr-namespace:pMusic.Interface"
        xmlns:shadui="clr-namespace:ShadUI;assembly=ShadUI"
        xmlns:converters="clr-namespace:ShadUI"
        xmlns:iconPacks="https://github.com/MahApps/IconPacks.Avalonia"
        xmlns:converter="clr-namespace:pMusic.Converter"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
        x:Class="pMusic.Views.MainWindow"
        x:DataType="vm:MainViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="pMusic">
    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
         to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainViewModel />
    </Design.DataContext>
    <Window.Resources>
        <converter:PlayingConverter x:Key="PlaybackStateToBooleanConverter" />
        <converter:Seconds x:Key="SecondsToMinutesConverter" />
    </Window.Resources>

    <Panel>
        <Grid ColumnDefinitions="Auto * Auto" RowDefinitions="* Auto">
            <shadui:Sidebar
                Grid.Column="0"
                Width="220"
                MinWidth="60"
                Padding="{Binding #Toggler.IsChecked, Converter={x:Static converters:BooleanConverters.SidebarPadding}}"
                BorderBrush="{DynamicResource BorderColor30}"
                BorderThickness="0,0,1,0"
                Expanded="{Binding #Toggler.IsChecked}">
                <shadui:Sidebar.ExpandEasing>
                    <shadui:EaseInOutBack BounceIntensity="Strong" />
                </shadui:Sidebar.ExpandEasing>
                <shadui:Sidebar.Header>
                    <ToggleButton
                        Name="Toggler"
                        Width="32"
                        Height="32"
                        Padding="8"
                        HorizontalAlignment="{Binding #Toggler.IsChecked, Converter={x:Static converters:BooleanConverters.SidebarTogglerHorizontalAlignment}}"
                        CornerRadius="{DynamicResource LgCornerRadius}"
                        Theme="{DynamicResource SideTogglerTheme}">
                        <Viewbox>
                            <iconPacks:PackIconLucide Kind="PanelLeft"></iconPacks:PackIconLucide>
                        </Viewbox>
                    </ToggleButton>
                </shadui:Sidebar.Header>
                <StackPanel Spacing="4">
                    <shadui:SidebarItem
                        Content="Home"
                        IsChecked="True"
                        Command="{Binding GoHome}"
                        Route="dashboard">
                        <shadui:SidebarItem.Icon>
                            <Viewbox>
                                <iconPacks:PackIconLucide Kind="House"></iconPacks:PackIconLucide>
                            </Viewbox>
                        </shadui:SidebarItem.Icon>
                    </shadui:SidebarItem>
                    <shadui:SidebarItem
                        Content="Your Library"
                        Command="{Binding GoHome}"
                        Route="theme">
                        <shadui:SidebarItem.Icon>
                            <Viewbox>
                                <iconPacks:PackIconLucide Kind="Library"></iconPacks:PackIconLucide>
                            </Viewbox>
                        </shadui:SidebarItem.Icon>
                    </shadui:SidebarItem>
                    <!-- <Separator Padding="4 16"></Separator> -->
                    <!-- <shadui:SidebarItemLabel -->
                    <!--     Margin="8,20,8,8" -->
                    <!--     AsSeparator="True" -->
                    <!--     Text="PLAYLISTS" /> -->
                    <!-- <shadui:SidebarItem -->
                    <!--     Content="Liked Songs" -->
                    <!--     Route="avatar" -->
                    <!--     ToolTip.Tip="{Binding $parent[shadui:Sidebar].Expanded, Converter={x:Static converters:BooleanConverters.NullOrString}, ConverterParameter='Avatar'}"> -->
                    <!--     <shadui:SidebarItem.Icon> -->
                    <!--         <Viewbox> -->
                    <!--             <iconPacks:PackIconLucide Kind="Heart"></iconPacks:PackIconLucide> -->
                    <!--         </Viewbox> -->
                    <!--     </shadui:SidebarItem.Icon> -->
                    <!-- </shadui:SidebarItem> -->
                </StackPanel>
            </shadui:Sidebar>
            <Grid Grid.Row="0" Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <Grid ColumnDefinitions="Auto, *, Auto" VerticalAlignment="Center" Margin="32 8 32 0"
                      ColumnSpacing="8">
                    <StackPanel Orientation="Horizontal">
                        <Button shadui:ElementAssist.Classes="Icon"
                                BorderBrush="{DynamicResource BorderColor}"
                                Classes="Icon"
                                Command="{Binding GoBack}">
                            <shadui:ButtonAssist.Icon>
                                <iconPacks:PackIconLucide Kind="ChevronLeft"></iconPacks:PackIconLucide>
                            </shadui:ButtonAssist.Icon>
                        </Button>
                        <Button shadui:ElementAssist.Classes="Icon"
                                BorderBrush="{DynamicResource BorderColor}"
                                Command="{Binding GoForward}">
                            <shadui:ButtonAssist.Icon>
                                <iconPacks:PackIconLucide Kind="ChevronRight"></iconPacks:PackIconLucide>
                            </shadui:ButtonAssist.Icon>
                        </Button>
                    </StackPanel>
                    <StackPanel Grid.Column="1" MaxWidth="750">
                        <TextBox
                            MaxWidth="750"
                            shadui:TextBoxAssist.Clearable="True"
                            Watermark="Search here...">
                            <TextBox.InnerLeftContent>
                                <PathIcon
                                    Width="16"
                                    Data="{x:Static shadui:Icons.Search}"
                                    Opacity="0.75" Margin="8 0 0 0" />
                            </TextBox.InnerLeftContent>
                        </TextBox>
                    </StackPanel>
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                        <Menu HorizontalAlignment="Center" VerticalAlignment="Center">
                            <MenuItem
                                CornerRadius="{DynamicResource FullCornerRadius}"
                                shadui:MenuItemAssist.PopupHorizontalOffset="4"
                                shadui:MenuItemAssist.PopupPlacement="BottomEdgeAlignedRight"
                                shadui:MenuItemAssist.PopupVerticalOffset="4" Padding="0">
                                <MenuItem.Header>
                                    <shadui:Avatar
                                        CornerRadius="{DynamicResource FullCornerRadius}"
                                        Fallback="CN"
                                        IsVisible="{Binding !$parent[shadui:Sidebar].Expanded}"
                                        Opacity="{Binding !$parent[shadui:Sidebar].Expanded, Converter={x:Static converters:BooleanConverters.Opaque}}"
                                        Source="{Binding ThumbnailUrl}">
                                        <shadui:Avatar.Transitions>
                                            <Transitions>
                                                <DoubleTransition Property="Opacity" Duration="0:0:0.20" />
                                            </Transitions>
                                        </shadui:Avatar.Transitions>
                                    </shadui:Avatar>
                                </MenuItem.Header>
                                <shadui:MenuItemAssist.Label>
                                    <TextBlock Classes="Caption Muted" Text="My Account" />
                                </shadui:MenuItemAssist.Label>
                                <!-- <MenuItem -->
                                <!--     Width="224" -->
                                <!--     Header="Profile" -->
                                <!--     InputGesture="Ctrl + Shift + P" /> -->
                                <!-- <MenuItem Header="Billing" InputGesture="Ctrl + B" /> -->
                                <!-- <MenuItem Header="Settings" InputGesture="Ctrl + S" /> -->
                                <!-- <MenuItem Header="Keyboard shortcuts" InputGesture="Ctrl + K" /> -->
                                <!-- <Separator /> -->
                                <!-- <MenuItem Header="Team" /> -->
                                <!-- <MenuItem Header="Invite users"> -->
                                <!--     <MenuItem Width="128" Header="Email" /> -->
                                <!--     <MenuItem Header="Message" /> -->
                                <!--     <MenuItem Header="More..." /> -->
                                <!-- </MenuItem> -->
                                <!-- <MenuItem Header="New Team" InputGesture="Ctrl + T" /> -->
                                <!-- <Separator /> -->
                                <!-- <MenuItem Header="Github" /> -->
                                <!-- <MenuItem Header="Support" /> -->
                                <!-- <MenuItem Header="API" IsEnabled="False" /> -->
                                <!-- <Separator /> -->
                                <MenuItem Header="Log out"
                                          IsVisible="{Binding IsLoggedIn}"
                                          Command="{Binding LogoutCommand}" />
                                <!-- <Separator /> -->
                                <!-- <MenuItem Classes="Destructive" Header="Delete Account" /> -->
                            </MenuItem>
                        </Menu>
                    </StackPanel>
                </Grid>
                <ScrollViewer Grid.Row="1"
                              HorizontalScrollBarVisibility="Disabled"
                              VerticalScrollBarVisibility="Auto">
                    <UserControl Grid.Row="1"
                                 Content="{Binding CurrentView, Source={x:Static local:Navigation.Instance}}"
                                 Padding="32 0">
                        <ContentControl.DataTemplates>
                            <DataTemplate DataType="{x:Type vm:HomeViewModel}">
                                <views:HomeView />
                            </DataTemplate>
                            <DataTemplate DataType="{x:Type vm:AlbumViewModel}">
                                <views:AlbumView />
                            </DataTemplate>
                            <DataTemplate DataType="{x:Type vm:ArtistViewModel}">
                                <views:ArtistView />
                            </DataTemplate>
                            <DataTemplate DataType="{x:Type vm:TrackViewModel}">
                                <views:TrackView />
                            </DataTemplate>
                        </ContentControl.DataTemplates>
                    </UserControl>
                </ScrollViewer>
            </Grid>
            <Border Grid.Column="2" Grid.Row="0" BorderBrush="LightGray" BorderThickness="1 0 0 0"
                    IsVisible="{Binding IsSidecarOpen}">
                <Grid>
                    <views:SidecarView IsVisible="{Binding IsSidecarOpen}"></views:SidecarView>
                </Grid>
            </Border>
            <Border Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="1" BorderThickness="0 1 0 0" BorderBrush="WhiteSmoke">
                <Grid ColumnDefinitions="*, *, *"
                      VerticalAlignment="Bottom" Margin="8 0" MinHeight="90">
                    <!-- Bottom Music Player -->
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Stretch">
                        <Border CornerRadius="8" ClipToBounds="True" VerticalAlignment="Center">
                            <Image Source="{Binding MusicPlayer.Image}" Width="75" ClipToBounds="True"
                                   VerticalAlignment="Center" />
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="{Binding MusicPlayer.Track.Title}" FontWeight="Regular" FontSize="14"
                                       VerticalAlignment="Center" Margin="8 4" />
                            <TextBlock Text="{Binding MusicPlayer.Artist.Title}"
                                       VerticalAlignment="Center" Margin="8 4" />
                        </StackPanel>
                    </StackPanel>
                    <StackPanel Grid.Column="1" VerticalAlignment="Bottom" HorizontalAlignment="Center">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center"
                                    Spacing="8" Margin="0 0 0 -10">
                            <Button
                                shadui:ElementAssist.Classes="Icon"
                                Command="{Binding PrevTrack}"
                                BorderThickness="0">
                                <shadui:ButtonAssist.Icon>
                                    <LucideIcon Kind="Rewind" Size="2"></LucideIcon>
                                </shadui:ButtonAssist.Icon>
                            </Button>
                            <Grid HorizontalAlignment="Center">
                                <Button
                                    shadui:ElementAssist.Classes="Primary"
                                    Command="{Binding PlayPause}"
                                    CornerRadius="{DynamicResource FullCornerRadius}"
                                    IsVisible="{Binding MusicPlayer.MPlaybackState, Converter={StaticResource PlaybackStateToBooleanConverter}, ConverterParameter=NotPlaying}"
                                    Height="35"
                                    Width="35"
                                    Padding="6 7 7 7"
                                    VerticalAlignment="Center">
                                    <shadui:ButtonAssist.Icon>
                                        <LucideIcon Kind="Play" Size="4" StrokeWidth="2">
                                        </LucideIcon>
                                    </shadui:ButtonAssist.Icon>
                                </Button>
                                <Button
                                    shadui:ElementAssist.Classes="Primary"
                                    Command="{Binding PlayPause}"
                                    IsVisible="{Binding MusicPlayer.MPlaybackState, Converter={StaticResource PlaybackStateToBooleanConverter}}"
                                    CornerRadius="{DynamicResource FullCornerRadius}"
                                    Height="35"
                                    Width="35"
                                    Padding="6 7 7 7"
                                    VerticalAlignment="Center">
                                    <shadui:ButtonAssist.Icon>
                                        <LucideIcon Kind="Pause" Size="4" StrokeWidth="2"></LucideIcon>
                                    </shadui:ButtonAssist.Icon>
                                </Button>
                            </Grid>
                            <Button
                                shadui:ElementAssist.Classes="Icon"
                                Command="{Binding NextTrack}"
                                BorderThickness="0">
                                <shadui:ButtonAssist.Icon>
                                    <LucideIcon Kind="FastForward" Size="2"></LucideIcon>
                                </shadui:ButtonAssist.Icon>
                            </Button>
                        </StackPanel>
                        <Grid ColumnDefinitions="30, *, 30" HorizontalAlignment="Stretch" ColumnSpacing="16">
                            <TextBlock
                                Text="{Binding MusicPlayer.Position, Converter={StaticResource SecondsToMinutesConverter}}"
                                VerticalAlignment="Center" />
                            <Slider Grid.Column="1" Value="{Binding MusicPlayer.Position}"
                                    IsEnabled="{Binding MusicPlayer.IsPlaying}"
                                    Maximum="{Binding MusicPlayer.Duration}"
                                    Width="350"
                                    x:Name="MySlider" VerticalAlignment="Center" />
                            <TextBlock Grid.Column="2"
                                       Text="{Binding MusicPlayer.Track.Duration, Converter={StaticResource SecondsToMinutesConverter}}"
                                       VerticalAlignment="Center" />
                        </Grid>
                    </StackPanel>
                    <StackPanel Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Right"
                                Orientation="Horizontal">
                        <Button shadui:ElementAssist.Classes="Icon" Command="{Binding ToggleSidecarCommand}"
                                VerticalAlignment="Center">
                            <shadui:ButtonAssist.Icon>
                                <LucideIcon Kind="ListMusic"></LucideIcon>
                            </shadui:ButtonAssist.Icon>
                        </Button>
                        <Button shadui:ElementAssist.Classes="Icon" Command="{Binding MuteCommand}"
                                VerticalAlignment="Center"
                                CommandParameter="{Binding MusicPlayer.Muted}"
                                IsVisible="{Binding MusicPlayer.MutedOpposite}">
                            <shadui:ButtonAssist.Icon>
                                <LucideIcon Kind="Volume2"></LucideIcon>
                            </shadui:ButtonAssist.Icon>
                        </Button>
                        <Button shadui:ElementAssist.Classes="Icon" Command="{Binding MuteCommand}"
                                VerticalAlignment="Center"
                                CommandParameter="{Binding MusicPlayer.Muted}"
                                IsVisible="{Binding MusicPlayer.Muted}">
                            <shadui:ButtonAssist.Icon>
                                <LucideIcon Kind="VolumeX"></LucideIcon>
                            </shadui:ButtonAssist.Icon>
                        </Button>
                        <Slider Minimum="0" Maximum="1" Value="{Binding MusicPlayer.Volume}" MinWidth="100"
                                VerticalAlignment="Center" />
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Panel>
</Window>