<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:pMusic.ViewModels"
             xmlns:heroIcons="clr-namespace:HeroIconsAvalonia.Controls;assembly=HeroIconsAvalonia"
             xmlns:converter="clr-namespace:pMusic.Converter"
             xmlns:shadUi="clr-namespace:ShadUI;assembly=ShadUI"
             xmlns:converters="clr-namespace:ShadUI"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="pMusic.Views.MainView"
             x:DataType="vm:MainViewModel">
    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
         to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainViewModel />
    </Design.DataContext>
    <UserControl.Resources>
        <converter:PlayingConverter x:Key="PlaybackStateToBooleanConverter" />
        <converter:Seconds x:Key="SecondsToMinutesConverter" />
    </UserControl.Resources>

    <UserControl.Styles>
        <Style Selector="Border.Panel">
            <Setter Property="Background" Value="{DynamicResource SystemChromeHighColor}" />
            <!-- <Setter Property="Background" Value="{DynamicResource RegionColor}"></Setter> -->
        </Style>
        <Style Selector="StackPanel.SidePanel">
            <!-- <Setter Property="">100</Setter> -->
            <Setter Property="Height">40</Setter>
            <Setter Property="Width">40</Setter>
        </Style>
        <Style Selector="ListBoxItem">
            <Setter Property="Padding" Value="0" />
        </Style>
        <Style Selector="ItemsControl /template/ ContentPresenter">
            <Setter Property="Background" Value="Transparent" />
        </Style>
        <Style Selector="ItemsControl:pointerover /template/ ContentPresenter">
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Background"
                    Value="{DynamicResource SystemChromeHighColor}" />
        </Style>
        <!-- <Style Selector="StackPanel.SidePanel-Item:pointerover"> -->
        <!--     <Setter Property="Background" -->
        <!--             Value="{DynamicResource SystemChromeHighColor}" /> -->
        <!-- </Style> -->
        <Style Selector="StackPanel.SidePanel-Item:pointerover /template/ ContentPresenter">
            <Setter Property="Padding" Value="8" />
        </Style>
    </UserControl.Styles>
    <Grid RowDefinitions="Auto, *, 100">
        <Grid ColumnDefinitions="Auto, *, Auto" Margin="8, 8 8 2">
            <StackPanel Orientation="Horizontal">
                <Button Classes="Icon" BorderThickness="0" Command="{Binding GoBack}">
                    <heroIcons:HeroIcon Foreground="{DynamicResource SukiText}" Type="ChevronLeft" Min="True" />
                </Button>
                <Button Classes="Icon" BorderThickness="0"
                        Command="{Binding GoForward}">
                    <heroIcons:HeroIcon Foreground="{DynamicResource SukiText}" Type="ChevronRight" Min="True" />
                </Button>
            </StackPanel>
            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="4">
                <Button Classes="Home Flat Basic Accent Icon" Command="{Binding GoHome}">
                    <heroIcons:HeroIcon Foreground="{DynamicResource SukiText}" Type="Home" Kind="Solid"
                                        Margin="0 0 0 4" />
                </Button>
                <TextBox Padding="20 12" CornerRadius="30" VerticalAlignment="Center">Search for your musics'</TextBox>
            </StackPanel>
            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                <Menu HorizontalAlignment="Center" VerticalAlignment="Center">
                    <MenuItem
                        CornerRadius="{DynamicResource LgCornerRadius}"
                        shadUi:MenuItemAssist.PopupHorizontalOffset="4"
                        shadUi:MenuItemAssist.PopupPlacement="BottomEdgeAlignedRight"
                        shadUi:MenuItemAssist.PopupVerticalOffset="4" Padding="0">
                        <MenuItem.Header>
                            <shadUi:Avatar
                                CornerRadius="{DynamicResource LgCornerRadius}"
                                Fallback="CN"
                                IsVisible="{Binding !$parent[shadUi:Sidebar].Expanded}"
                                Opacity="{Binding !$parent[shadUi:Sidebar].Expanded, Converter={x:Static converters:BooleanConverters.Opaque}}"
                                Source="{Binding ThumbnailUrl}">
                                <shadUi:Avatar.Transitions>
                                    <Transitions>
                                        <DoubleTransition Property="Opacity" Duration="0:0:0.20" />
                                    </Transitions>
                                </shadUi:Avatar.Transitions>
                            </shadUi:Avatar>
                        </MenuItem.Header>
                        <shadUi:MenuItemAssist.Label>
                            <TextBlock Classes="Caption Muted" Text="My Account" />
                        </shadUi:MenuItemAssist.Label>
                        <MenuItem
                            Width="224"
                            Header="Profile"
                            InputGesture="Ctrl + Shift + P" />
                        <MenuItem Header="Billing" InputGesture="Ctrl + B" />
                        <MenuItem Header="Settings" InputGesture="Ctrl + S" />
                        <MenuItem Header="Keyboard shortcuts" InputGesture="Ctrl + K" />
                        <Separator />
                        <MenuItem Header="Team" />
                        <MenuItem Header="Invite users">
                            <MenuItem Width="128" Header="Email" />
                            <MenuItem Header="Message" />
                            <MenuItem Header="More..." />
                        </MenuItem>
                        <MenuItem Header="New Team" InputGesture="Ctrl + T" />
                        <Separator />
                        <MenuItem Header="Github" />
                        <MenuItem Header="Support" />
                        <MenuItem Header="API" IsEnabled="False" />
                        <Separator />
                        <MenuItem Header="Log out" InputGesture="Ctrl + Shift + Q" IsVisible="{Binding IsLoggedIn}"
                                  Command="{Binding LogoutCommand}" />
                        <Separator />
                        <MenuItem Classes="Destructive" Header="Delete Account" />
                    </MenuItem>
                </Menu>
            </StackPanel>
        </Grid>
        <Grid Grid.Row="1" ColumnDefinitions="Auto, 2*, Auto">
        </Grid>
        <Grid Grid.Row="2" ColumnDefinitions="*, *, *" VerticalAlignment="Center" Margin="8 0">
            <!-- Bottom Music Player -->
            <StackPanel Orientation="Horizontal" VerticalAlignment="Stretch">
                <Border CornerRadius="8" ClipToBounds="True" VerticalAlignment="Center">
                    <Image Source="{Binding MusicPlayer.Image}" Width="75" ClipToBounds="True"
                           VerticalAlignment="Center" />
                </Border>
                <StackPanel VerticalAlignment="Center">
                    <TextBlock Text="{Binding MusicPlayer.Track.Title}"
                               VerticalAlignment="Center" Margin="8 4" />
                    <TextBlock Text="{Binding MusicPlayer.Artist.Title}"
                               VerticalAlignment="Center" Margin="8 4" />
                </StackPanel>
            </StackPanel>
            <StackPanel Grid.Column="1" VerticalAlignment="Stretch" HorizontalAlignment="Center">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center"
                            Spacing="8">
                    <Button
                        Classes="Basic Icon"
                        Command="{Binding PrevTrack}"
                        BorderThickness="0">
                        <heroIcons:HeroIcon Foreground="{DynamicResource SukiText}" Type="Backward" />
                    </Button>
                    <Grid HorizontalAlignment="Center">
                        <Button
                            Classes="Flat Icon"
                            Command="{Binding PlayPause}"
                            IsVisible="{Binding MusicPlayer.MPlaybackState, Converter={StaticResource PlaybackStateToBooleanConverter}, ConverterParameter=NotPlaying}"
                            VerticalAlignment="Center">
                            <heroIcons:HeroIcon Foreground="{DynamicResource SukiText}" Type="Play"
                                                Kind="Solid" Min="True" Margin="2 0 0 0" />
                        </Button>
                        <Button
                            Classes="Flat Icon"
                            Command="{Binding PlayPause}"
                            IsVisible="{Binding MusicPlayer.MPlaybackState, Converter={StaticResource PlaybackStateToBooleanConverter}}"
                            Padding="0"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                            <heroIcons:HeroIcon Foreground="{DynamicResource SukiText}" Type="Pause"
                                                Kind="Solid" Min="True" />
                        </Button>
                    </Grid>
                    <Button
                        Classes="Basic Icon"
                        Command="{Binding NextTrack}"
                        BorderThickness="0">
                        <heroIcons:HeroIcon Foreground="{DynamicResource SukiText}" Type="Forward" />
                    </Button>
                </StackPanel>
                <Grid ColumnDefinitions="30, *, 30" HorizontalAlignment="Stretch">
                    <TextBlock
                        Text="{Binding MusicPlayer.Position, Converter={StaticResource SecondsToMinutesConverter}}"
                        VerticalAlignment="Center" />
                    <!-- <Slider Grid.Column="1" Value="{Binding MusicPlayer.Position}" -->
                    <!--         Maximum="{Binding MusicPlayer.Duration}" -->
                    <!--         Width="350" -->
                    <!--         Thumb.DragCompleted="Thumb_OnDragCompleted" -->
                    <!--         x:Name="MySlider" VerticalAlignment="Center" -->
                    <!--         AttachedToVisualTree="Slider_AttachedToVisualTree" /> -->
                    <TextBlock Grid.Column="2"
                               Text="{Binding MusicPlayer.Track.Duration, Converter={StaticResource SecondsToMinutesConverter}}"
                               VerticalAlignment="Center" />
                </Grid>

            </StackPanel>
            <StackPanel Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Right" Orientation="Horizontal">
                <Button Classes="Basic Icon" Command="{Binding ToggleSidecarCommand}" VerticalAlignment="Center">
                    <heroIcons:HeroIcon Type="QueueList" Min="True" Foreground="{DynamicResource SukiText}"></heroIcons:HeroIcon>
                </Button>
                <Button Classes="Basic Icon" Command="{Binding MuteCommand}" VerticalAlignment="Center"
                        CommandParameter="{Binding MusicPlayer.Muted}"
                        IsVisible="{Binding MusicPlayer.MutedOpposite}">
                    <heroIcons:HeroIcon Type="SpeakerWave" Min="True" Foreground="{DynamicResource SukiText}"></heroIcons:HeroIcon>
                </Button>
                <Button Classes="Basic Icon" Command="{Binding MuteCommand}" VerticalAlignment="Center"
                        CommandParameter="{Binding MusicPlayer.Muted}"
                        IsVisible="{Binding MusicPlayer.Muted}">
                    <heroIcons:HeroIcon Type="SpeakerXMark" Min="True" Foreground="{DynamicResource SukiText}"></heroIcons:HeroIcon>
                </Button>
                <Slider Minimum="0" Maximum="1" Value="{Binding MusicPlayer.Volume}" MinWidth="100"
                        VerticalAlignment="Center" />
            </StackPanel>
        </Grid>
    </Grid>
    <!-- <TextBlock Text="{Binding Greeting}" HorizontalAlignment="Center" VerticalAlignment="Center"/> -->
</UserControl>